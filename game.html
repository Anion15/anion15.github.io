<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>아기 도티를 잡아라! - 병맛 리듬 폭발</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            user-select: none;
        }

        .game-container {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          margin: 0;
          padding: 0;
          background: linear-gradient(45deg, #23272a 90%, #111 100%), linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
          background-blend-mode: multiply;
          background-size: 400% 400%;
          animation: optimizedGradientShift 8s linear infinite;
          overflow: hidden;
          z-index: 0;
          filter: blur(0px) brightness(1) contrast(1) hue-rotate(0deg) saturate(1);
          transform: perspective(1000px) rotateX(0deg) rotateY(0deg) rotateZ(0deg) scale(1);
          transition: all 0.1s ease;
        }

        @keyframes optimizedGradientShift {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .game-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 100;
            filter: drop-shadow(0 0 10px #fff);
            transform: perspective(500px) rotateX(0deg) rotateY(0deg) rotateZ(0deg) scale(1);
            transition: all 0.1s ease;
        }

        .score {
            margin-bottom: 10px;
            font-weight: bold;
            animation: optimizedBounce 2s ease-in-out infinite;
        }

        @keyframes optimizedBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .combo {
            font-size: 18px;
            color: #ffed4e;
            margin-bottom: 10px;
            font-weight: bold;
            animation: comboSpin 3s linear infinite;
        }

        @keyframes comboSpin {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.2); }
            50% { transform: rotate(180deg) scale(1); }
            75% { transform: rotate(270deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .timer {
            font-size: 22px;
            color: #ff6b6b;
            font-weight: bold;
            animation: optimizedPulse 1s ease-in-out infinite;
        }

        @keyframes optimizedPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .timer.warning {
            animation: timerWarning 0.3s ease-in-out infinite;
        }

        @keyframes timerWarning {
            0%, 100% { 
                color: #ff6b6b; 
                transform: scale(1) rotate(0deg);
                filter: hue-rotate(0deg);
            }
            25% { 
                color: #ff3333; 
                transform: scale(1.4) rotate(-20deg);
                filter: hue-rotate(90deg);
            }
            50% {
                color: #ffff00;
                transform: scale(1.6) rotate(20deg);
                filter: hue-rotate(180deg);
            }
            75% { 
                color: #ff0066; 
                transform: scale(1.4) rotate(-10deg);
                filter: hue-rotate(270deg);
            }
        }

        .doti-baby {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            border: 3px solid #fff;
            cursor: pointer;
            transition: all 0.1s ease;
            animation: crazyDotiBounce 0.4s ease-in-out infinite alternate;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2), 0 0 20px rgba(255,255,255,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            overflow: hidden;
            filter: hue-rotate(0deg) brightness(1.2) contrast(1.3) saturate(1.5);
            transform: perspective(200px) rotateX(0deg) rotateY(0deg) rotateZ(0deg) scale(1);
        }

        /* inline dino image used in headings */
        .dino-inline {
            width: 48px;
            height: 48px;
            object-fit: contain;
            display: inline-block;
            vertical-align: middle;
            filter: drop-shadow(0 0 5px #fff);
            margin: 0 6px;
        }

        @keyframes crazyDotiBounce {
            0% { 
                transform: translateY(0px) scale(1) rotateZ(0deg) skewX(0deg);
                filter: hue-rotate(0deg) brightness(1.2);
            }
            25% {
                transform: translateY(-10px) scale(1.2) rotateZ(45deg) skewX(10deg);
                filter: hue-rotate(90deg) brightness(1.5);
            }
            50% {
                transform: translateY(-5px) scale(0.9) rotateZ(90deg) skewX(-5deg);
                filter: hue-rotate(180deg) brightness(1.1);
            }
            75% {
                transform: translateY(-15px) scale(1.3) rotateZ(135deg) skewX(15deg);
                filter: hue-rotate(270deg) brightness(1.4);
            }
            100% { 
                transform: translateY(-8px) scale(1.1) rotateZ(180deg) skewX(-10deg);
                filter: hue-rotate(360deg) brightness(1.3);
            }
        }

        .doti-baby::before {
            /* use project image instead of emoji */
            content: "";
            display: block;
            width: 48px;
            height: 48px;
            background-image: url('image.png');
            background-size: cover;
            background-position: center;
            animation: dotiWiggle 0.5s ease-in-out infinite;
            filter: drop-shadow(0 0 5px #fff);
        }

        @keyframes dotiWiggle {
            0%, 100% { 
                transform: rotate(0deg) scale(1) skewY(0deg);
                filter: hue-rotate(0deg);
            }
            25% { 
                transform: rotate(-15deg) scale(1.2) skewY(10deg);
                filter: hue-rotate(90deg);
            }
            50% {
                transform: rotate(10deg) scale(0.8) skewY(-5deg);
                filter: hue-rotate(180deg);
            }
            75% { 
                transform: rotate(20deg) scale(1.3) skewY(15deg);
                filter: hue-rotate(270deg);
            }
        }

        .doti-baby:hover {
            transform: scale(1.5) rotate(360deg);
            box-shadow: 0 10px 30px rgba(255,255,255,0.8), 0 0 50px rgba(255,107,107,0.8);
            filter: hue-rotate(180deg) brightness(2) contrast(2);
            animation: hoverCrazy 0.2s ease-in-out infinite;
        }

        @keyframes hoverCrazy {
            0%, 100% { transform: scale(1.5) rotateZ(0deg) skewX(0deg); }
            25% { transform: scale(1.7) rotateZ(90deg) skewX(20deg); }
            50% { transform: scale(1.3) rotateZ(180deg) skewX(-15deg); }
            75% { transform: scale(1.8) rotateZ(270deg) skewX(25deg); }
        }

        .doti-baby.collected {
            animation: collectAnimation 0.8s ease-out forwards;
        }

        @keyframes collectAnimation {
            0% {
                transform: scale(1) rotateZ(0deg);
                opacity: 1;
                filter: hue-rotate(0deg) brightness(1);
            }
            25% {
                transform: scale(2) rotateZ(180deg) skewX(45deg);
                opacity: 0.9;
                filter: hue-rotate(90deg) brightness(2);
            }
            50% {
                transform: scale(3) rotateZ(360deg) skewY(30deg);
                opacity: 0.7;
                filter: hue-rotate(180deg) brightness(3) blur(2px);
            }
            75% {
                transform: scale(2.5) rotateZ(540deg) skewX(-30deg);
                opacity: 0.4;
                filter: hue-rotate(270deg) brightness(4) blur(5px);
            }
            100% {
                transform: scale(0) rotateZ(720deg) skewY(90deg);
                opacity: 0;
                filter: hue-rotate(360deg) brightness(5) blur(10px);
            }
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ffed4e;
            border-radius: 50%;
            pointer-events: none;
            animation: particleExplode 1.5s ease-out forwards;
            box-shadow: 0 0 10px #ffed4e, 0 0 20px #ff6b6b;
        }

        @keyframes particleExplode {
            0% {
                transform: translateY(0) scale(1) rotate(0deg);
                opacity: 1;
                filter: hue-rotate(0deg) brightness(2);
            }
            50% {
                transform: translateY(-80px) scale(2) rotate(360deg);
                opacity: 0.8;
                filter: hue-rotate(180deg) brightness(3);
            }
            100% {
                transform: translateY(-120px) scale(0) rotate(720deg);
                opacity: 0;
                filter: hue-rotate(360deg) brightness(5) blur(5px);
            }
        }

        .start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 2000;
            filter: blur(0px) brightness(1) hue-rotate(0deg);
            animation: screenPulse 2s ease-in-out infinite;
        }

        @keyframes screenPulse {
            0%, 100% {
                filter: blur(0px) brightness(1) hue-rotate(0deg) contrast(1);
                transform: scale(1) rotate(0deg);
            }
            50% {
                filter: blur(1px) brightness(1.3) hue-rotate(30deg) contrast(1.5);
                transform: scale(1.02) rotate(1deg);
            }
        }

        .music-activation-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 3000;
            animation: musicScreenDance 1.5s ease-in-out infinite;
        }

        @keyframes musicScreenDance {
            0%, 100% {
                transform: scale(1) rotate(0deg) skewX(0deg);
                filter: hue-rotate(0deg) brightness(1);
            }
            25% {
                transform: scale(1.05) rotate(2deg) skewX(2deg);
                filter: hue-rotate(45deg) brightness(1.2);
            }
            50% {
                transform: scale(0.98) rotate(-1deg) skewX(-1deg);
                filter: hue-rotate(90deg) brightness(0.9);
            }
            75% {
                transform: scale(1.03) rotate(3deg) skewX(3deg);
                filter: hue-rotate(135deg) brightness(1.1);
            }
        }

        .music-activation-screen h1 {
            font-size: 48px;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: titleCrazyDance 1s ease-in-out infinite;
        }

        @keyframes titleCrazyDance {
            0%, 100% { 
                transform: scale(1) rotate(0deg) skewX(0deg);
                filter: hue-rotate(0deg) drop-shadow(0 0 10px #fff);
            }
            20% { 
                transform: scale(1.2) rotate(10deg) skewX(5deg);
                filter: hue-rotate(72deg) drop-shadow(0 0 20px #ff6b6b);
            }
            40% {
                transform: scale(0.9) rotate(-15deg) skewX(-8deg);
                filter: hue-rotate(144deg) drop-shadow(0 0 15px #4ecdc4);
            }
            60% {
                transform: scale(1.3) rotate(20deg) skewX(10deg);
                filter: hue-rotate(216deg) drop-shadow(0 0 25px #ffed4e);
            }
            80% {
                transform: scale(0.8) rotate(-5deg) skewX(-3deg);
                filter: hue-rotate(288deg) drop-shadow(0 0 30px #96ceb4);
            }
        }

        .music-icon {
            font-size: 120px;
            margin-bottom: 20px;
            animation: iconMadness 1.2s ease-in-out infinite;
            filter: drop-shadow(0 0 20px #fff);
        }

        @keyframes iconMadness {
            0%, 100% { 
                transform: translateY(0px) scale(1) rotate(0deg) skewY(0deg);
                filter: hue-rotate(0deg) drop-shadow(0 0 20px #fff);
            }
            25% { 
                transform: translateY(-30px) scale(1.5) rotate(90deg) skewY(15deg);
                filter: hue-rotate(90deg) drop-shadow(0 0 40px #ff6b6b);
            }
            50% {
                transform: translateY(-10px) scale(0.7) rotate(180deg) skewY(-10deg);
                filter: hue-rotate(180deg) drop-shadow(0 0 30px #4ecdc4);
            }
            75% {
                transform: translateY(-40px) scale(1.8) rotate(270deg) skewY(20deg);
                filter: hue-rotate(270deg) drop-shadow(0 0 50px #ffed4e);
            }
        }

        .music-activate-button {
            padding: 20px 40px;
            font-size: 28px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            border-radius: 30px;
            color: white;
            cursor: pointer;
            transition: all 0.1s ease;
            margin: 20px;
            animation: buttonInsanity 0.8s ease-in-out infinite;
            filter: drop-shadow(0 0 15px #fff);
            transform: perspective(300px) rotateX(0deg) rotateY(0deg);
        }

        @keyframes buttonInsanity {
            0%, 100% { 
                transform: scale(1) rotate(0deg) skewX(0deg) perspective(300px) rotateY(0deg);
                background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            }
            25% {
                transform: scale(1.2) rotate(5deg) skewX(10deg) perspective(300px) rotateY(45deg);
                background: linear-gradient(45deg, #4ecdc4, #ffed4e);
                box-shadow: 0 10px 30px rgba(255,107,107,0.8);
            }
            50% {
                transform: scale(0.9) rotate(-10deg) skewX(-5deg) perspective(300px) rotateY(90deg);
                background: linear-gradient(45deg, #ffed4e, #96ceb4);
                box-shadow: 0 15px 35px rgba(78,205,196,0.8);
            }
            75% {
                transform: scale(1.3) rotate(15deg) skewX(15deg) perspective(300px) rotateY(135deg);
                background: linear-gradient(45deg, #96ceb4, #ff6b6b);
                box-shadow: 0 20px 40px rgba(255,237,78,0.8);
            }
        }

        .music-activate-button:hover {
            transform: scale(1.4) rotate(360deg) skewX(20deg) perspective(300px) rotateY(180deg);
            box-shadow: 0 25px 50px rgba(0,0,0,0.8);
            animation: hoverButtonCrazy 0.3s ease-in-out infinite;
        }

        @keyframes hoverButtonCrazy {
            0%, 100% { filter: hue-rotate(0deg) brightness(1.5) blur(0px); }
            50% { filter: hue-rotate(180deg) brightness(2) blur(1px); }
        }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 2500;
            animation: gameOverShake 2s ease-in-out infinite;
        }

        @keyframes gameOverShake {
            0%, 100% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                filter: hue-rotate(0deg) brightness(1);
            }
            10% {
                transform: translate(-5px, -5px) scale(1.02) rotate(1deg);
                filter: hue-rotate(36deg) brightness(1.1);
            }
            20% {
                transform: translate(5px, -5px) scale(0.98) rotate(-1deg);
                filter: hue-rotate(72deg) brightness(0.9);
            }
            30% {
                transform: translate(-5px, 5px) scale(1.01) rotate(2deg);
                filter: hue-rotate(108deg) brightness(1.2);
            }
            40% {
                transform: translate(5px, 5px) scale(0.99) rotate(-2deg);
                filter: hue-rotate(144deg) brightness(0.8);
            }
            50% {
                transform: translate(0, 0) scale(1.05) rotate(0deg);
                filter: hue-rotate(180deg) brightness(1.3);
            }
        }

        .final-score {
            font-size: 48px;
            margin: 20px 0;
            color: #ffed4e;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: scoreCelebration 1s ease-in-out infinite;
        }

        @keyframes scoreCelebration {
            0%, 100% {
                transform: scale(1) rotate(0deg) skewX(0deg);
                filter: hue-rotate(0deg) drop-shadow(0 0 20px #ffed4e);
            }
            25% {
                transform: scale(1.3) rotate(10deg) skewX(5deg);
                filter: hue-rotate(90deg) drop-shadow(0 0 40px #ff6b6b);
            }
            50% {
                transform: scale(0.8) rotate(-5deg) skewX(-8deg);
                filter: hue-rotate(180deg) drop-shadow(0 0 30px #4ecdc4);
            }
            75% {
                transform: scale(1.5) rotate(15deg) skewX(12deg);
                filter: hue-rotate(270deg) drop-shadow(0 0 50px #96ceb4);
            }
        }

        .start-screen h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: titleMegaDance 1.5s ease-in-out infinite;
        }

        @keyframes titleMegaDance {
            0%, 100% { 
                transform: scale(1) rotate(0deg) skewX(0deg) perspective(500px) rotateY(0deg);
                filter: hue-rotate(0deg) drop-shadow(0 0 15px #fff);
            }
            16% {
                transform: scale(1.2) rotate(15deg) skewX(10deg) perspective(500px) rotateY(60deg);
                filter: hue-rotate(60deg) drop-shadow(0 0 25px #ff6b6b);
            }
            33% {
                transform: scale(0.9) rotate(-20deg) skewX(-5deg) perspective(500px) rotateY(120deg);
                filter: hue-rotate(120deg) drop-shadow(0 0 20px #4ecdc4);
            }
            50% {
                transform: scale(1.4) rotate(25deg) skewX(15deg) perspective(500px) rotateY(180deg);
                filter: hue-rotate(180deg) drop-shadow(0 0 35px #ffed4e);
            }
            66% {
                transform: scale(0.8) rotate(-10deg) skewX(-12deg) perspective(500px) rotateY(240deg);
                filter: hue-rotate(240deg) drop-shadow(0 0 30px #96ceb4);
            }
            83% {
                transform: scale(1.3) rotate(30deg) skewX(20deg) perspective(500px) rotateY(300deg);
                filter: hue-rotate(300deg) drop-shadow(0 0 40px #ff9a9e);
            }
        }

        .start-button {
            padding: 15px 30px;
            font-size: 24px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.1s ease;
            margin: 10px;
            animation: startButtonChaos 1s ease-in-out infinite;
            filter: drop-shadow(0 0 10px #fff);
        }

        @keyframes startButtonChaos {
            0%, 100% {
                transform: scale(1) rotate(0deg) skewY(0deg);
                background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            }
            20% {
                transform: scale(1.1) rotate(8deg) skewY(5deg);
                background: linear-gradient(45deg, #4ecdc4, #ffed4e);
                box-shadow: 0 8px 20px rgba(255,107,107,0.6);
            }
            40% {
                transform: scale(0.95) rotate(-12deg) skewY(-3deg);
                background: linear-gradient(45deg, #ffed4e, #96ceb4);
                box-shadow: 0 10px 25px rgba(78,205,196,0.6);
            }
            60% {
                transform: scale(1.15) rotate(20deg) skewY(8deg);
                background: linear-gradient(45deg, #96ceb4, #ff9a9e);
                box-shadow: 0 12px 30px rgba(255,237,78,0.6);
            }
            80% {
                transform: scale(0.9) rotate(-5deg) skewY(-2deg);
                background: linear-gradient(45deg, #ff9a9e, #ff6b6b);
                box-shadow: 0 15px 35px rgba(150,206,180,0.6);
            }
        }

        .start-button:hover {
            transform: scale(1.3) rotate(360deg) skewY(30deg);
            box-shadow: 0 20px 40px rgba(0,0,0,0.8);
            animation: startButtonHoverMadness 0.2s ease-in-out infinite;
        }

        @keyframes startButtonHoverMadness {
            0%, 100% { 
                filter: hue-rotate(0deg) brightness(2) blur(0px) contrast(2);
                transform: scale(1.3) rotate(0deg) skewY(30deg);
            }
            50% { 
                filter: hue-rotate(180deg) brightness(3) blur(1px) contrast(3);
                transform: scale(1.5) rotate(180deg) skewY(-20deg);
            }
        }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 2500;
            animation: gameOverShake 2s ease-in-out infinite;
        }

        @keyframes gameOverShake {
            0%, 100% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                filter: hue-rotate(0deg) brightness(1);
            }
            10% {
                transform: translate(-5px, -5px) scale(1.02) rotate(1deg);
                filter: hue-rotate(36deg) brightness(1.1);
            }
            20% {
                transform: translate(5px, -5px) scale(0.98) rotate(-1deg);
                filter: hue-rotate(72deg) brightness(0.9);
            }
            30% {
                transform: translate(-5px, 5px) scale(1.01) rotate(2deg);
                filter: hue-rotate(108deg) brightness(1.2);
            }
            40% {
                transform: translate(5px, 5px) scale(0.99) rotate(-2deg);
                filter: hue-rotate(144deg) brightness(0.8);
            }
            50% {
                transform: translate(0, 0) scale(1.05) rotate(0deg);
                filter: hue-rotate(180deg) brightness(1.3);
            }
        }

        .final-score {
            font-size: 48px;
            margin: 20px 0;
            color: #ffed4e;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: scoreCelebration 1s ease-in-out infinite;
        }

        @keyframes scoreCelebration {
            0%, 100% {
                transform: scale(1) rotate(0deg) skewX(0deg);
                filter: hue-rotate(0deg) drop-shadow(0 0 20px #ffed4e);
            }
            25% {
                transform: scale(1.3) rotate(10deg) skewX(5deg);
                filter: hue-rotate(90deg) drop-shadow(0 0 40px #ff6b6b);
            }
            50% {
                transform: scale(0.8) rotate(-5deg) skewX(-8deg);
                filter: hue-rotate(180deg) drop-shadow(0 0 30px #4ecdc4);
            }
            75% {
                transform: scale(1.5) rotate(15deg) skewX(12deg);
                filter: hue-rotate(270deg) drop-shadow(0 0 50px #96ceb4);
            }
        }

        .start-screen h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: titleMegaDance 1.5s ease-in-out infinite;
        }

        @keyframes titleMegaDance {
            0%, 100% { 
                transform: scale(1) rotate(0deg) skewX(0deg) perspective(500px) rotateY(0deg);
                filter: hue-rotate(0deg) drop-shadow(0 0 15px #fff);
            }
            16% {
                transform: scale(1.2) rotate(15deg) skewX(10deg) perspective(500px) rotateY(60deg);
                filter: hue-rotate(60deg) drop-shadow(0 0 25px #ff6b6b);
            }
            33% {
                transform: scale(0.9) rotate(-20deg) skewX(-5deg) perspective(500px) rotateY(120deg);
                filter: hue-rotate(120deg) drop-shadow(0 0 20px #4ecdc4);
            }
            50% {
                transform: scale(1.4) rotate(25deg) skewX(15deg) perspective(500px) rotateY(180deg);
                filter: hue-rotate(180deg) drop-shadow(0 0 35px #ffed4e);
            }
            66% {
                transform: scale(0.8) rotate(-10deg) skewX(-12deg) perspective(500px) rotateY(240deg);
                filter: hue-rotate(240deg) drop-shadow(0 0 30px #96ceb4);
            }
            83% {
                transform: scale(1.3) rotate(30deg) skewX(20deg) perspective(500px) rotateY(300deg);
                filter: hue-rotate(300deg) drop-shadow(0 0 40px #ff9a9e);
            }
        }

        .start-button {
            padding: 15px 30px;
            font-size: 24px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.1s ease;
            margin: 10px;
            animation: startButtonChaos 1s ease-in-out infinite;
            filter: drop-shadow(0 0 10px #fff);
        }

        @keyframes startButtonChaos {
            0%, 100% {
                transform: scale(1) rotate(0deg) skewY(0deg);
                background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            }
            20% {
                transform: scale(1.1) rotate(8deg) skewY(5deg);
                background: linear-gradient(45deg, #4ecdc4, #ffed4e);
                box-shadow: 0 8px 20px rgba(255,107,107,0.6);
            }
            40% {
                transform: scale(0.95) rotate(-12deg) skewY(-3deg);
                background: linear-gradient(45deg, #ffed4e, #96ceb4);
                box-shadow: 0 10px 25px rgba(78,205,196,0.6);
            }
            60% {
                transform: scale(1.15) rotate(20deg) skewY(8deg);
                background: linear-gradient(45deg, #96ceb4, #ff9a9e);
                box-shadow: 0 12px 30px rgba(255,237,78,0.6);
            }
            80% {
                transform: scale(0.9) rotate(-5deg) skewY(-2deg);
                background: linear-gradient(45deg, #ff9a9e, #ff6b6b);
                box-shadow: 0 15px 35px rgba(150,206,180,0.6);
            }
        }

        .start-button:hover {
            transform: scale(1.3) rotate(360deg) skewY(30deg);
            box-shadow: 0 20px 40px rgba(0,0,0,0.8);
            animation: startButtonHoverMadness 0.2s ease-in-out infinite;
        }

        @keyframes startButtonHoverMadness {
            0%, 100% { 
                filter: hue-rotate(0deg) brightness(2) blur(0px) contrast(2);
                transform: scale(1.3) rotate(0deg) skewY(30deg);
            }
            50% { 
                filter: hue-rotate(180deg) brightness(3) blur(1px) contrast(3);
                transform: scale(1.5) rotate(180deg) skewY(-20deg);
            }
        }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 2500;
            animation: gameOverShake 2s ease-in-out infinite;
        }

        @keyframes gameOverShake {
            0%, 100% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                filter: hue-rotate(0deg) brightness(1);
            }
            10% {
                transform: translate(-5px, -5px) scale(1.02) rotate(1deg);
                filter: hue-rotate(36deg) brightness(1.1);
            }
            20% {
                transform: translate(5px, -5px) scale(0.98) rotate(-1deg);
                filter: hue-rotate(72deg) brightness(0.9);
            }
            30% {
                transform: translate(-5px, 5px) scale(1.01) rotate(2deg);
                filter: hue-rotate(108deg) brightness(1.2);
            }
            40% {
                transform: translate(5px, 5px) scale(0.99) rotate(-2deg);
                filter: hue-rotate(144deg) brightness(0.8);
            }
            50% {
                transform: translate(0, 0) scale(1.05) rotate(0deg);
                filter: hue-rotate(180deg) brightness(1.3);
            }
        }

        .final-score {
            font-size: 48px;
            margin: 20px 0;
            color: #ffed4e;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: scoreCelebration 1s ease-in-out infinite;
        }

        @keyframes scoreCelebration {
            0%, 100% {
                transform: scale(1) rotate(0deg) skewX(0deg);
                filter: hue-rotate(0deg) drop-shadow(0 0 20px #ffed4e);
            }
            25% {
                transform: scale(1.3) rotate(10deg) skewX(5deg);
                filter: hue-rotate(90deg) drop-shadow(0 0 40px #ff6b6b);
            }
            50% {
                transform: scale(0.8) rotate(-5deg) skewX(-8deg);
                filter: hue-rotate(180deg) drop-shadow(0 0 30px #4ecdc4);
            }
            75% {
                transform: scale(1.5) rotate(15deg) skewX(12deg);
                filter: hue-rotate(270deg) drop-shadow(0 0 50px #96ceb4);
            }
        }

        .start-screen h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: titleMegaDance 1.5s ease-in-out infinite;
        }

        @keyframes titleMegaDance {
            0%, 100% { 
                transform: scale(1) rotate(0deg) skewX(0deg) perspective(500px) rotateY(0deg);
                filter: hue-rotate(0deg) drop-shadow(0 0 15px #fff);
            }
            16% {
                transform: scale(1.2) rotate(15deg) skewX(10deg) perspective(500px) rotateY(60deg);
                filter: hue-rotate(60deg) drop-shadow(0 0 25px #ff6b6b);
            }
            33% {
                transform: scale(0.9) rotate(-20deg) skewX(-5deg) perspective(500px) rotateY(120deg);
                filter: hue-rotate(120deg) drop-shadow(0 0 20px #4ecdc4);
            }
            50% {
                transform: scale(1.4) rotate(25deg) skewX(15deg) perspective(500px) rotateY(180deg);
                filter: hue-rotate(180deg) drop-shadow(0 0 35px #ffed4e);
            }
            66% {
                transform: scale(0.8) rotate(-10deg) skewX(-12deg) perspective(500px) rotateY(240deg);
                filter: hue-rotate(240deg) drop-shadow(0 0 30px #96ceb4);
            }
            83% {
                transform: scale(1.3) rotate(30deg) skewX(20deg) perspective(500px) rotateY(300deg);
                filter: hue-rotate(300deg) drop-shadow(0 0 40px #ff9a9e);
            }
        }

        .start-button {
            padding: 15px 30px;
            font-size: 24px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.1s ease;
            margin: 10px;
            animation: startButtonChaos 1s ease-in-out infinite;
            filter: drop-shadow(0 0 10px #fff);
        }

        @keyframes startButtonChaos {
            0%, 100% {
                transform: scale(1) rotate(0deg) skewY(0deg);
                background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            }
            20% {
                transform: scale(1.1) rotate(8deg) skewY(5deg);
                background: linear-gradient(45deg, #4ecdc4, #ffed4e);
                box-shadow: 0 8px 20px rgba(255,107,107,0.6);
            }
            40% {
                transform: scale(0.95) rotate(-12deg) skewY(-3deg);
                background: linear-gradient(45deg, #ffed4e, #96ceb4);
                box-shadow: 0 10px 25px rgba(78,205,196,0.6);
            }
            60% {
                transform: scale(1.15) rotate(20deg) skewY(8deg);
                background: linear-gradient(45deg, #96ceb4, #ff9a9e);
                box-shadow: 0 12px 30px rgba(255,237,78,0.6);
            }
            80% {
                transform: scale(0.9) rotate(-5deg) skewY(-2deg);
                background: linear-gradient(45deg, #ff9a9e, #ff6b6b);
                box-shadow: 0 15px 35px rgba(150,206,180,0.6);
            }
        }

        .start-button:hover {
            transform: scale(1.3) rotate(360deg) skewY(30deg);
            box-shadow: 0 20px 40px rgba(0,0,0,0.8);
            animation: startButtonHoverMadness 0.2s ease-in-out infinite;
        }

        @keyframes startButtonHoverMadness {
            0%, 100% { 
                filter: hue-rotate(0deg) brightness(2) blur(0px) contrast(2);
                transform: scale(1.3) rotate(0deg) skewY(30deg);
            }
            50% { 
                filter: hue-rotate(180deg) brightness(3) blur(1px) contrast(3);
                transform: scale(1.5) rotate(180deg) skewY(-20deg);
            }
        }

        /* 최적화된 CSS 애니메이션 */
        @keyframes optimizedGradientShift {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        @keyframes optimizedBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes optimizedPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* 기존 애니메이션을 최적화된 애니메이션으로 대체 */
        .game-container {
            animation: optimizedGradientShift 8s linear infinite;
        }

        .score {
            animation: optimizedBounce 2s ease-in-out infinite;
        }

        .timer {
            animation: optimizedPulse 1s ease-in-out infinite;
        }

        /* 불필요한 애니메이션 제거 */
        .combo, .doti-baby:hover, .music-activate-button:hover {
            animation: none;
        }

        /* 오디오 숨기기 */
        audio {
            display: none;
        }

        /* 특수 리듬 효과 클래스들 */
        .rythm-bass-crazy {
            animation: bassCrazy 0.5s ease-in-out infinite;
        }

        @keyframes bassCrazy {
            0%, 100% {
                transform: scale(1) rotate(0deg);
                filter: blur(0px) brightness(1) hue-rotate(0deg);
            }
            50% {
                transform: scale(1.1) rotate(2deg);
                filter: blur(1px) brightness(1.3) hue-rotate(30deg);
            }
        }

        .rythm-kick-insane {
            animation: kickInsane 0.3s ease-in-out infinite;
        }

        @keyframes kickInsane {
            0%, 100% {
                transform: translateY(0) scale(1) skewX(0deg);
                filter: contrast(1) saturate(1);
            }
            50% {
                transform: translateY(-15px) scale(1.2) skewX(10deg);
                filter: contrast(2) saturate(2);
            }
        }

        .rythm-treble-wild {
            animation: trebleWild 0.2s ease-in-out infinite;
        }

        @keyframes trebleWild {
            0%, 100% {
                opacity: 1;
                filter: hue-rotate(0deg) brightness(1);
                transform: scale(1) rotate(0deg);
            }
            25% {
                opacity: 0.7;
                filter: hue-rotate(90deg) brightness(1.5);
                transform: scale(1.1) rotate(5deg);
            }
            50% {
                opacity: 0.9;
                filter: hue-rotate(180deg) brightness(0.8);
                transform: scale(0.95) rotate(-3deg);
            }
            75% {
                opacity: 0.8;
                filter: hue-rotate(270deg) brightness(1.2);
                transform: scale(1.05) rotate(8deg);
            }
        }

        .rythm-mid-chaos {
            animation: midChaos 0.4s ease-in-out infinite;
        }

        @keyframes midChaos {
            0%, 100% {
                transform: rotateZ(0deg) skewX(0deg) skewY(0deg);
                filter: contrast(1) hue-rotate(0deg);
            }
            20% {
                transform: rotateZ(10deg) skewX(5deg) skewY(2deg);
                filter: contrast(1.5) hue-rotate(72deg);
            }
            40% {
                transform: rotateZ(-15deg) skewX(-8deg) skewY(-3deg);
                filter: contrast(1.2) hue-rotate(144deg);
            }
            60% {
                transform: rotateZ(20deg) skewX(12deg) skewY(5deg);
                filter: contrast(1.8) hue-rotate(216deg);
            }
            80% {
                transform: rotateZ(-8deg) skewX(-3deg) skewY(-1deg);
                filter: contrast(1.3) hue-rotate(288deg);
            }
        }

        /* 배경 전체 효과 */
        .game-container.rhythm-active {
            animation: containerMadness 0.6s ease-in-out infinite;
        }

        @keyframes containerMadness {
            0%, 100% {
                transform: scale(1) rotate(0deg) skew(0deg);
                filter: blur(0px) brightness(1) contrast(1) hue-rotate(0deg) saturate(1);
            }
            16% {
                transform: scale(1.02) rotate(1deg) skew(0.5deg);
                filter: blur(0.5px) brightness(1.1) contrast(1.2) hue-rotate(30deg) saturate(1.3);
            }
            33% {
                transform: scale(0.99) rotate(-0.5deg) skew(-0.3deg);
                filter: blur(0px) brightness(0.95) contrast(1.1) hue-rotate(60deg) saturate(1.1);
            }
            50% {
                transform: scale(1.03) rotate(1.5deg) skew(0.8deg);
                filter: blur(1px) brightness(1.2) contrast(1.4) hue-rotate(90deg) saturate(1.5);
            }
            66% {
                transform: scale(0.98) rotate(-1deg) skew(-0.6deg);
                filter: blur(0.3px) brightness(0.9) contrast(1.05) hue-rotate(120deg) saturate(0.9);
            }
            83% {
                transform: scale(1.01) rotate(2deg) skew(0.4deg);
                filter: blur(0.8px) brightness(1.15) contrast(1.3) hue-rotate(150deg) saturate(1.2);
            }
        }

        /* 폰트 춤추기 효과 */
        .dancing-text {
            display: inline-block;
            animation: textDance 0.8s ease-in-out infinite;
        }

        @keyframes textDance {
            0%, 100% {
                transform: translateY(0) scale(1) rotate(0deg) skewX(0deg);
                filter: hue-rotate(0deg);
            }
            20% {
                transform: translateY(-3px) scale(1.1) rotate(5deg) skewX(2deg);
                filter: hue-rotate(60deg);
            }
            40% {
                transform: translateY(2px) scale(0.95) rotate(-3deg) skewX(-1deg);
                filter: hue-rotate(120deg);
            }
            60% {
                transform: translateY(-5px) scale(1.15) rotate(8deg) skewX(4deg);
                filter: hue-rotate(180deg);
            }
            80% {
                transform: translateY(1px) scale(0.9) rotate(-2deg) skewX(-0.5deg);
                filter: hue-rotate(240deg);
            }
        }

        /* 글리치 효과 */
        .glitch-effect {
            position: relative;
            animation: glitch 2s infinite;
        }

        @keyframes glitch {
            0%, 100% {
                transform: translate(0);
                filter: hue-rotate(0deg);
            }
            2% {
                transform: translate(2px, 0);
                filter: hue-rotate(90deg);
            }
            4% {
                transform: translate(-2px, 0);
                filter: hue-rotate(180deg);
            }
            6% {
                transform: translate(0);
                filter: hue-rotate(270deg);
            }
            8% {
                transform: translate(2px, -2px);
                filter: hue-rotate(360deg);
            }
            10% {
                transform: translate(-1px, 2px);
                filter: hue-rotate(45deg);
            }
            12% {
                transform: translate(-3px, 1px);
                filter: hue-rotate(135deg);
            }
            14% {
                transform: translate(3px, -1px);
                filter: hue-rotate(225deg);
            }
            16% {
                transform: translate(-1px, -1px);
                filter: hue-rotate(315deg);
            }
            18% {
                transform: translate(1px, 1px);
                filter: hue-rotate(0deg);
            }
        }

        /* 펄스 효과 */
        .pulse-crazy {
            animation: pulseCrazy 1s ease-in-out infinite;
        }

        @keyframes pulseCrazy {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7);
                filter: brightness(1);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 0 20px rgba(255, 107, 107, 0);
                filter: brightness(1.3);
            }
        }

        /* 네온 글로우 효과 */
        .neon-glow {
            text-shadow: 
                0 0 5px #fff,
                0 0 10px #fff,
                0 0 15px #ff6b6b,
                0 0 20px #ff6b6b,
                0 0 35px #ff6b6b,
                0 0 40px #ff6b6b;
            animation: neonFlicker 1.5s infinite alternate;
        }

        @keyframes neonFlicker {
            0%, 100% {
                text-shadow: 
                    0 0 5px #fff,
                    0 0 10px #fff,
                    0 0 15px #ff6b6b,
                    0 0 20px #ff6b6b,
                    0 0 35px #ff6b6b,
                    0 0 40px #ff6b6b;
            }
            50% {
                text-shadow: 
                    0 0 2px #fff,
                    0 0 5px #fff,
                    0 0 8px #4ecdc4,
                    0 0 12px #4ecdc4,
                    0 0 18px #4ecdc4,
                    0 0 25px #4ecdc4;
            }
        }

        /* 회전 무지개 효과 */
        .rainbow-spin {
            animation: rainbowSpin 1s linear infinite;
        }

        @keyframes rainbowSpin {
            0% { filter: hue-rotate(0deg) saturate(2) brightness(1.2); }
            25% { filter: hue-rotate(90deg) saturate(2.5) brightness(1.4); }
            50% { filter: hue-rotate(180deg) saturate(3) brightness(1.6); }
            75% { filter: hue-rotate(270deg) saturate(2.5) brightness(1.4); }
            100% { filter: hue-rotate(360deg) saturate(2) brightness(1.2); }
        }

        /* 젤리 바운스 효과 */
        .jelly-bounce {
            animation: jellyBounce 0.6s ease-in-out infinite;
        }

        @keyframes jellyBounce {
            0%, 100% {
                transform: scale(1, 1) skewX(0deg);
            }
            30% {
                transform: scale(1.25, 0.75) skewX(5deg);
            }
            40% {
                transform: scale(0.75, 1.25) skewX(-3deg);
            }
            50% {
                transform: scale(1.15, 0.85) skewX(2deg);
            }
            65% {
                transform: scale(0.95, 1.05) skewX(-1deg);
            }
            75% {
                transform: scale(1.05, 0.95) skewX(0.5deg);
            }
        }
    </style>
</head>
<body>
    <!-- 오디오 엘리먼트 -->
    <audio id="music" loop>
        <source src="music.mp3" type="audio/mpeg">
        <source src="music.ogg" type="audio/ogg">
        <source src="music.wav" type="audio/wav">
        Your browser does not support the audio element.
    </audio>
    <!-- 점수 획득 효과음 (호잇짜) -->
    <audio id="effect-hoitja" src="1111.mp3" preload="auto"></audio>

    <div class="game-container rythm-bass-crazy glitch-effect" id="gameContainer">
        <div class="volume-control rainbow-spin">
            <span class="dancing-text">🔊</span>
            <input type="range" class="volume-slider pulse-crazy" id="volumeSlider" min="0" max="1" step="0.1" value="0.7" onchange="changeVolume(this.value)">
        </div>

        <div class="game-ui rythm-mid-chaos neon-glow">
            <div class="score jelly-bounce">점수: <span id="score" class="dancing-text rainbow-spin">0</span></div>
            <div class="combo pulse-crazy">콤보: <span id="combo" class="dancing-text glitch-effect">0</span></div>
            <div class="timer rythm-kick-insane neon-glow" id="timer">시간: <span class="dancing-text">30</span></div>
        </div>

        <!-- 음악 활성화 화면 -->
        <div class="music-activation-screen rythm-bass-crazy glitch-effect" id="musicActivationScreen">
            <div class="music-icon rainbow-spin pulse-crazy">🎵</div>
            <h1 class="rythm-mid-chaos neon-glow dancing-text">음악과 함께 플레이하세요!</h1>
            <div class="instructions rythm-treble-wild">
                <p class="dancing-text">🎶 최고의 게임 경험을 위해 음악을 활성화해주세요</p>
                <p class="dancing-text">🎵 음악에 맞춰 화면이 리듬감 있게 움직입니다</p>
                <p class="dancing-text">🔊 볼륨을 조절하여 원하는 크기로 설정하세요</p>
            </div>
            <button class="music-activate-button rythm-kick-insane jelly-bounce neon-glow" onclick="activateMusic()">🎵 음악 활성화하기</button>
        </div>

        <div class="start-screen rythm-bass-crazy glitch-effect" id="startScreen" style="display: none;">
            <h1 class="rythm-mid-chaos neon-glow rainbow-spin"><img src="image.png" class="dino-inline" alt="도티"> <span class="dancing-text">아기</span> <span class="dancing-text">도티를</span> <span class="dancing-text">잡아라!</span> <img src="image.png" class="dino-inline" alt="도티"></h1>
            <div class="instructions rythm-treble-wild pulse-crazy">
                <p class="dancing-text">🎵 음악에 맞춰 떨어지는 도티 아기들을 수집하세요!</p>
                <p class="dancing-text">🖱️ 마우스 클릭 또는 터치로 도티 아기를 터치하세요</p>
                <p class="dancing-text">⚡ 연속으로 수집하면 콤보 보너스!</p>
                <p class="dancing-text">⏰ 30초 안에 최고 점수에 도전하세요!</p>
                <p class="dancing-text">🎶 음악의 리듬에 맞춰 플레이하세요!</p>
            </div>
            <button class="start-button rythm-kick-insane jelly-bounce neon-glow" onclick="startGame()">게임 시작</button>
        </div>

        <div class="game-over rythm-bass-crazy glitch-effect" id="gameOverScreen">
            <h1 class="rythm-mid-chaos neon-glow rainbow-spin">🎉 <span class="dancing-text">게임</span> <span class="dancing-text">종료!</span> 🎉</h1>
            <div class="final-score jelly-bounce pulse-crazy">최종 점수: <span id="finalScore" class="dancing-text rainbow-spin neon-glow">0</span></div>
            <div class="instructions rythm-treble-wild">
                <p class="dancing-text">축하합니다! 30초 동안 열심히 플레이했네요!</p>
                <p class="dancing-text">더 높은 점수에 도전해보세요!</p>
            </div>
            <button class="start-button rythm-kick-insane jelly-bounce neon-glow" onclick="restartGame()">다시 시작</button>
        </div>
    </div>

    <!-- Rythm.js 라이브러리 로드 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rythm.js/2.2.5/rythm.min.js"></script>

    <script>
        let rythm;
        let musicElement;
        let isPlaying = false;
        let isMusicActivated = false;

        class DinoDanceGame {
            constructor() {
                this.container = document.getElementById('gameContainer');
                this.score = 0;
                this.combo = 0;
                this.gameRunning = false;
                this.dotiObjects = [];
                this.spawnRate = 0.7;
                this.timeLeft = 30;
                this.gameTimer = null;
                
                this.setupEventListeners();
                this.initializeRythm();
                this.startCrazyEffects();
            }

            initializeRythm() {
                musicElement = document.getElementById('music');
                musicElement.volume = 0.7;
                
                // Rythm.js 초기화 - 병맛 효과 대폭 강화
                try {
                    rythm = new Rythm();
                    
                    // 베이스 - 전체 컨테이너 미친듯이 흔들기
                    rythm.addRythm('game-container', 'pulse', 0, 50, {
                        min: 0.98,
                        max: 1.05
                    });
                    
                    rythm.addRythm('game-container', 'shake', 50, 150, {
                        min: 0,
                        max: 8
                    });
                    
                    rythm.addRythm('game-container', 'twist', 0, 300, {
                        min: -3,
                        max: 3
                    });

                    // 화면 전체 색상 변화 - 무지개 폭발
                    rythm.addRythm('game-container', 'color', 0, 100, {
                        from: [102, 126, 234],
                        to: [255, 107, 107]
                    });

                    rythm.addRythm('game-container', 'borderColor', 100, 500, {
                        from: [255, 255, 255],
                        to: [78, 205, 196]
                    });

                    // UI 요소들 - 킥드럼에 맞춰 튕기기
                    rythm.addRythm('game-ui', 'jump', 100, 400, {
                        min: 0,
                        max: 30
                    });

                    rythm.addRythm('game-ui', 'twist', 200, 800, {
                        min: -25,
                        max: 25
                    });

                    rythm.addRythm('game-ui', 'pulse', 0, 200, {
                        min: 0.9,
                        max: 1.3
                    });

                    // 점수/콤보 - 미드레인지 프리퀀시
                    rythm.addRythm('score', 'shake', 400, 1200, {
                        min: 0,
                        max: 15
                    });

                    rythm.addRythm('combo', 'vanish', 500, 1500, {
                        min: 0.7,
                        max: 1.0
                    });

                    rythm.addRythm('combo', 'twist', 300, 1000, {
                        min: -45,
                        max: 45
                    });

                    // 타이머 - 고음역대에서 미친듯이 깜빡이기
                    rythm.addRythm('timer', 'pulse', 1000, 8000, {
                        min: 0.8,
                        max: 2.0
                    });

                    rythm.addRythm('timer', 'color', 2000, 8000, {
                        from: [255, 107, 107],
                        to: [255, 237, 78]
                    });

                    // 도티 아기들 - 모든 프리퀀시에서 춤추기
                    rythm.addRythm('doti-baby', 'jump', 0, 200, {
                        min: 0,
                        max: 25
                    });

                    rythm.addRythm('doti-baby', 'twist', 200, 1000, {
                        min: -30,
                        max: 30
                    });

                    rythm.addRythm('doti-baby', 'pulse', 500, 2000, {
                        min: 0.7,
                        max: 1.4
                    });

                    rythm.addRythm('doti-baby', 'shake', 100, 500, {
                        min: 0,
                        max: 20
                    });

                    // 버튼들 - 베이스와 킥에 맞춰 폭발적으로
                    rythm.addRythm('start-button', 'pulse', 0, 300, {
                        min: 0.8,
                        max: 1.5
                    });

                    rythm.addRythm('start-button', 'jump', 50, 200, {
                        min: 0,
                        max: 40
                    });

                    rythm.addRythm('music-activate-button', 'twist', 0, 500, {
                        min: -45,
                        max: 45
                    });

                    rythm.addRythm('music-activate-button', 'pulse', 100, 400, {
                        min: 0.7,
                        max: 1.6
                    });

                    // 볼륨 컨트롤 - 고음역대에서 반응
                    rythm.addRythm('volume-control', 'shake', 2000, 8000, {
                        min: 0,
                        max: 10
                    });

                    rythm.addRythm('volume-slider', 'pulse', 1500, 6000, {
                        min: 0.9,
                        max: 1.2
                    });

                    // 파티클과 이펙트들
                    rythm.addRythm('particle', 'jump', 0, 400, {
                        min: 0,
                        max: 50
                    });

                    rythm.addRythm('trail', 'pulse', 200, 1000, {
                        min: 0.5,
                        max: 2.0
                    });

                    // 화면 전체 - 저음역대에서 전체적인 움직임
                    rythm.addRythm('start-screen', 'shake', 0, 100, {
                        min: 0,
                        max: 5
                    });

                    rythm.addRythm('music-activation-screen', 'twist', 0, 200, {
                        min: -5,
                        max: 5
                    });

                    rythm.addRythm('game-over', 'pulse', 0, 300, {
                        min: 0.95,
                        max: 1.1
                    });

                    // 텍스트 요소들 - 각 글자별로 춤추게 하기
                    rythm.addRythm('dancing-text', 'jump', 200, 800, {
                        min: 0,
                        max: 15
                    });

                    rythm.addRythm('dancing-text', 'twist', 400, 1200, {
                        min: -20,
                        max: 20
                    });

                    // 추가 병맛 효과들
                    rythm.addRythm('neon-glow', 'vanish', 1000, 4000, {
                        min: 0.8,
                        max: 1.0
                    });

                    rythm.addRythm('rainbow-spin', 'color', 0, 2000, {
                        from: [255, 0, 0],
                        to: [0, 255, 255]
                    });

                    rythm.addRythm('jelly-bounce', 'pulse', 100, 600, {
                        min: 0.8,
                        max: 1.4
                    });

                    rythm.addRythm('pulse-crazy', 'shake', 50, 300, {
                        min: 0,
                        max: 12
                    });

                    rythm.addRythm('glitch-effect', 'twist', 0, 1000, {
                        min: -10,
                        max: 10
                    });

                    // Rythm.js에 오디오 연결
                    rythm.setMusic(musicElement);
                } catch (error) {
                    console.log('Rythm.js 초기화 실패:', error);
                    rythm = null;
                }
            }

            startCrazyEffects() {
                // 추가적인 병맛 효과들을 수동으로 시작
                setInterval(() => {
                    if (isPlaying) {
                        this.addRandomGlitchEffect();
                        this.addRandomColorFlash();
                        this.makeElementsDance();
                    }
                }, 200);

                // 도티들에게 랜덤 효과 추가
                setInterval(() => {
                    if (this.gameRunning) {
                        this.addRandomDotiEffects();
                    }
                }, 100);

                // 배경 필터 효과
                setInterval(() => {
                    if (isPlaying) {
                        this.addBackgroundFilters();
                    }
                }, 150);
            }

            addRandomGlitchEffect() {
                const elements = document.querySelectorAll('.dancing-text');
                if (elements.length > 0) {
                    const randomElement = elements[Math.floor(Math.random() * elements.length)];
                    randomElement.style.transform += ` translateX(${Math.random() * 4 - 2}px)`;
                    randomElement.style.filter = `hue-rotate(${Math.random() * 360}deg)`;
                    
                    setTimeout(() => {
                        randomElement.style.transform = '';
                        randomElement.style.filter = '';
                    }, 100);
                }
            }

            addRandomColorFlash() {
                const container = document.getElementById('gameContainer');
                const hue = Math.random() * 360;
                container.style.filter += ` hue-rotate(${hue}deg)`;
                
                setTimeout(() => {
                    container.style.filter = container.style.filter.replace(/hue-rotate\([^)]*\)/g, '');
                }, 50);
            }

            makeElementsDance() {
                const allElements = document.querySelectorAll('*');
                const randomElements = Array.from(allElements).slice(0, 10);
                
                randomElements.forEach(element => {
                    if (Math.random() < 0.1) {
                        const randomRotation = Math.random() * 10 - 5;
                        const randomScale = 0.98 + Math.random() * 0.04;
                        element.style.transform += ` rotate(${randomRotation}deg) scale(${randomScale})`;
                        
                        setTimeout(() => {
                            element.style.transform = element.style.transform.replace(/rotate\([^)]*\)/g, '').replace(/scale\([^)]*\)/g, '');
                        }, 200);
                    }
                });
            }

            addRandomDotiEffects() {
                this.dotiObjects.forEach(doti => {
                    if (Math.random() < 0.3) {
                        const effects = ['rainbow-spin', 'jelly-bounce', 'pulse-crazy', 'neon-glow'];
                        const randomEffect = effects[Math.floor(Math.random() * effects.length)];
                        doti.element.classList.add(randomEffect);
                        
                        setTimeout(() => {
                            doti.element.classList.remove(randomEffect);
                        }, 500);
                    }
                });
            }

            addBackgroundFilters() {
                const container = document.getElementById('gameContainer');
                const filters = [
                    `brightness(${0.9 + Math.random() * 0.3})`,
                    `contrast(${0.8 + Math.random() * 0.6})`,
                    `saturate(${0.7 + Math.random() * 0.8})`,
                    `blur(${Math.random() * 2}px)`
                ];
                
                const randomFilter = filters[Math.floor(Math.random() * filters.length)];
                container.style.filter += ` ${randomFilter}`;
                
                setTimeout(() => {
                    container.style.filter = 'none';
                }, 100);
            }

            setupEventListeners() {
                document.addEventListener('mousemove', (e) => {
                    if (this.gameRunning) {
                        this.handleMouseMove(e);
                    }
                });

                document.addEventListener('click', (e) => {
                    if (this.gameRunning) {
                        this.handleClick(e);
                        this.addClickEffect(e.clientX, e.clientY);
                    }
                });

                document.addEventListener('touchmove', (e) => {
                    if (this.gameRunning) {
                        const touch = e.touches[0];
                        this.handleMouseMove(touch);
                    }
                });

                document.addEventListener('touchstart', (e) => {
                    if (this.gameRunning) {
                        e.preventDefault();
                        const touch = e.touches[0];
                        this.handleClick(touch);
                        this.addClickEffect(touch.clientX, touch.clientY);
                    }
                }, { passive: false });
            }

            addClickEffect(x, y) {
                const clickEffect = document.createElement('div');
                clickEffect.className = 'rainbow-spin pulse-crazy';
                clickEffect.style.position = 'fixed';
                clickEffect.style.left = (x - 25) + 'px';
                clickEffect.style.top = (y - 25) + 'px';
                clickEffect.style.width = '50px';
                clickEffect.style.height = '50px';
                clickEffect.style.borderRadius = '50%';
                clickEffect.style.background = 'radial-gradient(circle, rgba(255,255,255,0.8), rgba(255,107,107,0.4))';
                clickEffect.style.pointerEvents = 'none';
                clickEffect.style.zIndex = '9999';
                clickEffect.style.animation = 'clickExplosion 0.8s ease-out forwards';
                clickEffect.style.boxShadow = '0 0 20px #fff, 0 0 40px #ff6b6b, 0 0 60px #4ecdc4';
                
                // 클릭 폭발 애니메이션 동적 생성
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes clickExplosion {
                        0% {
                            transform: scale(0) rotate(0deg);
                            opacity: 1;
                            filter: hue-rotate(0deg) brightness(2);
                        }
                        50% {
                            transform: scale(3) rotate(180deg);
                            opacity: 0.8;
                            filter: hue-rotate(180deg) brightness(3);
                        }
                        100% {
                            transform: scale(6) rotate(360deg);
                            opacity: 0;
                            filter: hue-rotate(360deg) brightness(5) blur(5px);
                        }
                    }
                `;
                document.head.appendChild(style);
                document.body.appendChild(clickEffect);
                
                setTimeout(() => {
                    if (clickEffect.parentNode) {
                        clickEffect.parentNode.removeChild(clickEffect);
                    }
                    if (style.parentNode) {
                        style.parentNode.removeChild(style);
                    }
                }, 800);
            }

            start() {
                this.gameRunning = true;
                this.score = 0;
                this.combo = 0;
                this.timeLeft = 30;
                this.updateUI();
                
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('gameOverScreen').style.display = 'none';
                
                // 게임 시작 시 컨테이너에 리듬 클래스 추가
                this.container.classList.add('rhythm-active');
                
                if (isMusicActivated && !isPlaying) {
                    this.startMusic();
                }
                
                this.gameTimer = setInterval(() => {
                    this.timeLeft--;
                    this.updateUI();
                    
                    const timerElement = document.getElementById('timer');
                    if (this.timeLeft <= 10) {
                        timerElement.classList.add('warning');
                        timerElement.classList.add('glitch-effect');
                    } else {
                        timerElement.classList.remove('warning');
                        timerElement.classList.remove('glitch-effect');
                    }
                    
                    if (this.timeLeft <= 0) {
                        this.endGame();
                    }
                }, 1000);
                
                this.difficultyTimer = setInterval(() => {
                    if (this.gameRunning) {
                        this.spawnRate = Math.min(this.spawnRate + 0.05, 1.5);
                    }
                }, 3000);

                this.spawnTimer = setInterval(() => {
                    if (this.gameRunning && Math.random() < this.spawnRate) {
                        this.spawnDotiBaby();
                    }
                }, 400);
            }

            startMusic() {
                musicElement.play().then(() => {
                    if (rythm) {
                        rythm.start();
                    }
                    isPlaying = true;
                    
                    // 음악 시작과 함께 화면 전체가 미친듯이 춤추기 시작
                    document.body.classList.add('rythm-bass-crazy');
                    this.container.classList.add('rhythm-active');
                }).catch(error => {
                    console.log('음악 재생 실패:', error);
                });
            }

            endGame() {
                this.gameRunning = false;
                
                // 리듬 효과 제거
                this.container.classList.remove('rhythm-active');
                
                if (this.gameTimer) {
                    clearInterval(this.gameTimer);
                    this.gameTimer = null;
                }
                if (this.difficultyTimer) {
                    clearInterval(this.difficultyTimer);
                    this.difficultyTimer = null;
                }
                if (this.spawnTimer) {
                    clearInterval(this.spawnTimer);
                    this.spawnTimer = null;
                }
                
                this.dotiObjects.forEach(doti => {
                    if (doti.element.parentNode) {
                        doti.element.parentNode.removeChild(doti.element);
                    }
                });
                this.dotiObjects = [];
                
                // 게임 오버 축제 효과
                this.celebrateGameOver();
                
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('gameOverScreen').style.display = 'flex';
            }

            celebrateGameOver() {
                // 게임 오버 시 화면 전체에 폭죽 효과
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        this.createCelebrationFirework();
                    }, i * 100);
                }
            }

            createCelebrationFirework() {
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight;
                
                for (let i = 0; i < 12; i++) {
                    const firework = document.createElement('div');
                    firework.className = 'rainbow-spin neon-glow';
                    firework.style.position = 'fixed';
                    firework.style.left = x + 'px';
                    firework.style.top = y + 'px';
                    firework.style.width = '8px';
                    firework.style.height = '8px';
                    firework.style.borderRadius = '50%';
                    firework.style.background = `hsl(${Math.random() * 360}, 100%, 60%)`;
                    firework.style.pointerEvents = 'none';
                    firework.style.zIndex = '9999';
                    
                    const angle = (i / 12) * Math.PI * 2;
                    const distance = 100 + Math.random() * 100;
                    const endX = x + Math.cos(angle) * distance;
                    const endY = y + Math.sin(angle) * distance;
                    
                    firework.style.animation = `fireworkExplosion 1.5s ease-out forwards`;
                    
                    // 동적 애니메이션 생성
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes fireworkExplosion {
                            0% {
                                transform: translate(0, 0) scale(1) rotate(0deg);
                                opacity: 1;
                                filter: brightness(2) hue-rotate(0deg);
                            }
                            100% {
                                transform: translate(${endX - x}px, ${endY - y}px) scale(0) rotate(720deg);
                                opacity: 0;
                                filter: brightness(5) hue-rotate(360deg) blur(3px);
                            }
                        }
                    `;
                    document.head.appendChild(style);
                    document.body.appendChild(firework);
                    
                    setTimeout(() => {
                        if (firework.parentNode) {
                            firework.parentNode.removeChild(firework);
                        }
                        if (style.parentNode) {
                            style.parentNode.removeChild(style);
                        }
                    }, 1500);
                }
            }

            spawnDotiBaby() {
                const doti = document.createElement('div');
                doti.className = 'doti-baby rythm-kick-insane rythm-mid-chaos rythm-treble-wild rainbow-spin jelly-bounce';
                
                const x = Math.random() * (window.innerWidth - 60);
                const y = -60;
                
                doti.style.left = x + 'px';
                doti.style.top = y + 'px';
                
                // 극도로 화려한 색상 조합
                const colors = [
                    'linear-gradient(45deg, #ff9a9e, #fecfef)',
                    'linear-gradient(45deg, #a8edea, #fed6e3)',
                    'linear-gradient(45deg, #ffecd2, #fcb69f)',
                    'linear-gradient(45deg, #667eea, #764ba2)',
                    'linear-gradient(45deg, #f093fb, #f5576c)',
                    'linear-gradient(45deg, #4facfe, #00f2fe)',
                    'linear-gradient(45deg, #43e97b, #38f9d7)',
                    'linear-gradient(45deg, #fa709a, #fee140)',
                    'linear-gradient(45deg, #30cfd0, #91a7ff)',
                    'linear-gradient(45deg, #a8edea, #fed6e3)'
                ];
                doti.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                // 도티에게 랜덤 병맛 효과 추가
                const crazyEffects = ['glitch-effect', 'pulse-crazy', 'neon-glow'];
                if (Math.random() < 0.5) {
                    const randomEffect = crazyEffects[Math.floor(Math.random() * crazyEffects.length)];
                    doti.classList.add(randomEffect);
                }
                
                this.container.appendChild(doti);
                
                // detect mobile (simple UA check)
                const isMobile = /Mobi|Android|iPhone|iPad|iPod|IEMobile|BlackBerry|Opera Mini/i.test(navigator.userAgent);

                const dotiObj = {
                    element: doti,
                    x: x,
                    y: y,
                    // increased base speed and added acceleration properties
                    speed: 3 + Math.random() * 5, // was 2 + Math.random()*4
                    acceleration: 0.02 + Math.random() * 0.06, // per-frame speed increase
                    // platform-specific maxSpeed: higher cap on mobile, lower on PC
                    maxSpeed: isMobile ? (10 + Math.random() * 2.5) : (3 + Math.random() * 2.5),
                    wiggleOffset: Math.random() * Math.PI * 2,
                    rotationSpeed: Math.random() * 10 - 5,
                    collected: false
                };
                
                this.dotiObjects.push(dotiObj);
                
                doti.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (!dotiObj.collected) {
                        this.collectDoti(dotiObj);
                    }
                });
                
                this.animateDoti(dotiObj);
            }

            animateDoti(dotiObj) {
                const animate = () => {
                    if (!this.gameRunning || !dotiObj.element.parentNode) return;
                    
                    // apply acceleration so doti fall faster over time (with cap)
                    dotiObj.speed = Math.min(dotiObj.maxSpeed, dotiObj.speed + dotiObj.acceleration);
                    dotiObj.y += dotiObj.speed;
                    dotiObj.wiggleOffset += 0.2;
                    dotiObj.rotationSpeed += 0.1;
                    
                    // 극도로 병맛스러운 움직임
                    const wiggleX = Math.sin(dotiObj.wiggleOffset) * 30;
                    const wiggleY = Math.cos(dotiObj.wiggleOffset * 0.7) * 15;
                    const rotation = Math.sin(dotiObj.wiggleOffset * 1.5) * 45;
                    const scale = 1 + Math.sin(dotiObj.wiggleOffset * 2) * 0.3;
                    
                    dotiObj.element.style.top = (dotiObj.y + wiggleY) + 'px';
                    dotiObj.element.style.left = (dotiObj.x + wiggleX) + 'px';
                    dotiObj.element.style.transform = `rotate(${rotation}deg) scale(${scale}) skewX(${Math.sin(dotiObj.wiggleOffset) * 20}deg)`;
                    
                    // 랜덤 색상 변화
                    if (Math.random() < 0.1) {
                        dotiObj.element.style.filter = `hue-rotate(${Math.random() * 360}deg) brightness(${1 + Math.random() * 0.5})`;
                    }
                    
                    if (dotiObj.y > window.innerHeight + 100) {
                        this.removeDoti(dotiObj);
                        this.combo = 0;
                        this.updateUI();
                        this.createMissExplosion();
                        return;
                    }
                    
                    requestAnimationFrame(animate);
                };
                animate();
            }

            createMissExplosion() {
                // 놓쳤을 때 화면 전체에 실망 효과
                const container = document.getElementById('gameContainer');
                container.style.animation = 'missShake 0.5s ease-in-out';
                container.style.filter = 'hue-rotate(0deg) brightness(0.5) contrast(2)';
                
                setTimeout(() => {
                    container.style.animation = '';
                    container.style.filter = '';
                }, 500);
                
                // CSS 애니메이션 동적 추가
                if (!document.getElementById('missShakeStyle')) {
                    const style = document.createElement('style');
                    style.id = 'missShakeStyle';
                    style.textContent = `
                        @keyframes missShake {
                            0%, 100% { transform: translate(0, 0) rotate(0deg); }
                            10% { transform: translate(-10px, -5px) rotate(-2deg); }
                            20% { transform: translate(10px, -5px) rotate(2deg); }
                            30% { transform: translate(-8px, 5px) rotate(-1deg); }
                            40% { transform: translate(8px, 5px) rotate(1deg); }
                            50% { transform: translate(0, 0) rotate(0deg); }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }

            collectDoti(dotiObj) {
                if (dotiObj.collected) return;
                dotiObj.collected = true;
                dotiObj.element.classList.add('collected');
                
                this.score += 10 + (this.combo * 5);
                this.combo++;
                
                // 수집 시 극도로 화려한 효과
                this.createMegaParticles(dotiObj.x + 30, dotiObj.y + 30);
                this.createCollectExplosion(dotiObj.x + 30, dotiObj.y + 30);
                this.addScorePopup(dotiObj.x + 30, dotiObj.y + 30);
                
                // 효과음 재생 (여러 개 겹쳐도 OK)
                try {
                    const hoitja = new Audio('1111.mp3');
                    hoitja.currentTime = 8.2;
                    hoitja.volume = 0.8;
                    hoitja.playbackRate = 0.8 + Math.random() * 0.4; // 피치 변화
                    hoitja.play();
                    setTimeout(() => {
                        hoitja.pause();
                        hoitja.src = '';
                    }, 1200);
                } catch (error) {
                    console.log('효과음 재생 실패:', error);
                }
                
                setTimeout(() => {
                    this.removeDoti(dotiObj);
                }, 800);
                
                this.updateUI();
                
                // 콤보에 따른 화면 효과
                if (this.combo % 5 === 0 && this.combo > 0) {
                    this.triggerComboEffect();
                }
            }

            triggerComboEffect() {
                // 5콤보마다 화면 전체가 미친듯이 축하
                const container = document.getElementById('gameContainer');
                container.classList.add('rainbow-spin', 'jelly-bounce');
                container.style.animation = 'comboMadness 1s ease-in-out';
                
                // 콤보 축하 CSS
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes comboMadness {
                        0%, 100% { 
                            transform: scale(1) rotate(0deg);
                            filter: hue-rotate(0deg) brightness(1) contrast(1);
                        }
                        25% { 
                            transform: scale(1.05) rotate(5deg);
                            filter: hue-rotate(90deg) brightness(1.5) contrast(2);
                        }
                        50% { 
                            transform: scale(0.95) rotate(-3deg);
                            filter: hue-rotate(180deg) brightness(2) contrast(1.5);
                        }
                        75% { 
                            transform: scale(1.08) rotate(8deg);
                            filter: hue-rotate(270deg) brightness(1.8) contrast(2.5);
                        }
                    }
                `;
                document.head.appendChild(style);
                
                setTimeout(() => {
                    container.classList.remove('rainbow-spin', 'jelly-bounce');
                    container.style.animation = '';
                    if (style.parentNode) {
                        style.parentNode.removeChild(style);
                    }
                }, 1000);
            }

            addScorePopup(x, y) {
                const popup = document.createElement('div');
                popup.className = 'dancing-text neon-glow rainbow-spin';
                popup.textContent = `+${10 + (this.combo * 5)}`;
                popup.style.position = 'fixed';
                popup.style.left = x + 'px';
                popup.style.top = y + 'px';
                popup.style.fontSize = '24px';
                popup.style.fontWeight = 'bold';
                popup.style.color = '#ffed4e';
                popup.style.pointerEvents = 'none';
                popup.style.zIndex = '9999';
                popup.style.textShadow = '0 0 10px #ffed4e, 0 0 20px #ff6b6b, 0 0 30px #4ecdc4';
                popup.style.animation = 'scorePopup 1.5s ease-out forwards';
                
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes scorePopup {
                        0% {
                            transform: scale(0.5) translateY(0) rotate(0deg);
                            opacity: 1;
                            filter: hue-rotate(0deg) brightness(2);
                        }
                        50% {
                            transform: scale(2) translateY(-50px) rotate(180deg);
                            opacity: 0.9;
                            filter: hue-rotate(180deg) brightness(3);
                        }
                        100% {
                            transform: scale(0) translateY(-100px) rotate(360deg);
                            opacity: 0;
                            filter: hue-rotate(360deg) brightness(5) blur(5px);
                        }
                    }
                `;
                document.head.appendChild(style);
                document.body.appendChild(popup);
                
                setTimeout(() => {
                    if (popup.parentNode) {
                        popup.parentNode.removeChild(popup);
                    }
                    if (style.parentNode) {
                        style.parentNode.removeChild(style);
                    }
                }, 1500);
            }

            createCollectExplosion(x, y) {
                // 수집 시 대폭발 효과
                for (let i = 0; i < 15; i++) {
                    const explosion = document.createElement('div');
                    explosion.className = 'rainbow-spin pulse-crazy';
                    explosion.style.position = 'fixed';
                    explosion.style.left = x + 'px';
                    explosion.style.top = y + 'px';
                    explosion.style.width = '12px';
                    explosion.style.height = '12px';
                    explosion.style.borderRadius = '50%';
                    explosion.style.background = `hsl(${i * 24}, 100%, 60%)`;
                    explosion.style.pointerEvents = 'none';
                    explosion.style.zIndex = '9998';
                    explosion.style.boxShadow = '0 0 15px currentColor, 0 0 30px currentColor';
                    
                    const angle = (i / 15) * Math.PI * 2;
                    const distance = 80 + Math.random() * 120;
                    const endX = x + Math.cos(angle) * distance;
                    const endY = y + Math.sin(angle) * distance;
                    
                    explosion.style.animation = `collectExplosion 1.2s ease-out forwards`;
                    
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes collectExplosion {
                            0% {
                                transform: translate(0, 0) scale(0.2) rotate(0deg);
                                opacity: 1;
                                filter: brightness(3) hue-rotate(0deg);
                            }
                            50% {
                                transform: translate(${(endX - x) * 0.7}px, ${(endY - y) * 0.7}px) scale(1.5) rotate(360deg);
                                opacity: 0.8;
                                filter: brightness(4) hue-rotate(180deg);
                            }
                            100% {
                                transform: translate(${endX - x}px, ${endY - y}px) scale(0) rotate(720deg);
                                opacity: 0;
                                filter: brightness(6) hue-rotate(360deg) blur(8px);
                            }
                        }
                    `;
                    document.head.appendChild(style);
                    document.body.appendChild(explosion);
                    
                    setTimeout(() => {
                        if (explosion.parentNode) {
                            explosion.parentNode.removeChild(explosion);
                        }
                        if (style.parentNode) {
                            style.parentNode.removeChild(style);
                        }
                    }, 1200);
                }
            }

            createMegaParticles(x, y) {
                // 기존 파티클보다 훨씬 화려한 메가 파티클
                for (let i = 0; i < 25; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle rainbow-spin neon-glow jelly-bounce';
                    particle.style.left = x + Math.random() * 80 - 40 + 'px';
                    particle.style.top = y + Math.random() * 80 - 40 + 'px';
                    particle.style.width = (8 + Math.random() * 12) + 'px';
                    particle.style.height = particle.style.width;
                    particle.style.background = `hsl(${Math.random() * 360}, 100%, 60%)`;
                    particle.style.boxShadow = '0 0 15px currentColor, 0 0 30px currentColor, 0 0 45px rgba(255,255,255,0.5)';
                    particle.style.borderRadius = Math.random() < 0.5 ? '50%' : '20%';
                    
                    this.container.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 1500);
                }
            }

            removeDoti(dotiObj) {
                const index = this.dotiObjects.indexOf(dotiObj);
                if (index > -1) {
                    this.dotiObjects.splice(index, 1);
                    if (dotiObj.element.parentNode) {
                        dotiObj.element.parentNode.removeChild(dotiObj.element);
                    }
                }
            }

            handleClick(e) {
                if (!this.gameRunning) return;
                const clickX = e.clientX || e.pageX;
                const clickY = e.clientY || e.pageY;
                const nearbyDoti = this.dotiObjects.find(doti => {
                    if (doti.collected) return false;
                    const dx = (doti.x + 30) - clickX;
                    const dy = (doti.y + 30) - clickY;
                    return Math.sqrt(dx * dx + dy * dy) < 100;
                });
                if (nearbyDoti) {
                    this.collectDoti(nearbyDoti);
                } else {
                    this.createMissEffect(clickX, clickY);
                }
            }

            handleMouseMove(e) {
                if (Math.random() < 0.3) {
                    const x = e.clientX || e.pageX;
                    const y = e.clientY || e.pageY;
                    this.createCrazyTrail(x, y);
                }
            }

            createCrazyTrail(x, y) {
                const trail = document.createElement('div');
                trail.className = 'trail rainbow-spin pulse-crazy';
                trail.style.position = 'fixed';
                trail.style.left = (x - 20) + 'px';
                trail.style.top = (y - 20) + 'px';
                trail.style.pointerEvents = 'none';
                trail.style.background = `radial-gradient(circle, hsl(${Math.random() * 360}, 100%, 70%), transparent)`;
                document.body.appendChild(trail);
                setTimeout(() => {
                    if (trail.parentNode) {
                        trail.parentNode.removeChild(trail);
                    }
                }, 1200);
            }

            createMissEffect(x, y) {
                const missEffect = document.createElement('div');
                missEffect.className = 'glitch-effect pulse-crazy';
                missEffect.style.position = 'fixed';
                missEffect.style.left = (x - 15) + 'px';
                missEffect.style.top = (y - 15) + 'px';
                missEffect.style.width = '30px';
                missEffect.style.height = '30px';
                missEffect.style.borderRadius = '50%';
                missEffect.style.background = 'rgba(255, 100, 100, 0.8)';
                missEffect.style.animation = 'missRipple 0.8s ease-out forwards';
                missEffect.style.pointerEvents = 'none';
                missEffect.style.boxShadow = '0 0 20px #ff6464, 0 0 40px #ff6464';
                document.body.appendChild(missEffect);
                setTimeout(() => {
                    if (missEffect.parentNode) {
                        missEffect.parentNode.removeChild(missEffect);
                    }
                }, 800);
            }

            updateUI() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('combo').textContent = this.combo;
                document.getElementById('timer').textContent = `시간: ${this.timeLeft}`;
                
                // UI 업데이트 시 추가 효과
                if (this.combo > 0) {
                    const comboElement = document.getElementById('combo');
                    comboElement.style.transform = `scale(${1 + this.combo * 0.1}) rotate(${this.combo * 10}deg)`;
                    comboElement.style.filter = `hue-rotate(${this.combo * 30}deg) brightness(${1 + this.combo * 0.1})`;
                }
            }
        }

        let game;

        // 음악 활성화 함수
        function activateMusic() {
            musicElement.play().then(() => {
                if (rythm) {
                    rythm.start();
                }
                isPlaying = true;
                isMusicActivated = true;
                
                // 음악 시작과 함께 모든 요소가 미친듯이 춤추기 시작
                document.body.classList.add('rythm-bass-crazy', 'rainbow-spin');
                
                document.getElementById('musicActivationScreen').style.display = 'none';
                document.getElementById('startScreen').style.display = 'flex';
            }).catch(error => {
                console.log('음악 재생 실패:', error);
                isMusicActivated = false;
                document.getElementById('musicActivationScreen').style.display = 'none';
                document.getElementById('startScreen').style.display = 'flex';
            });
        }

        function changeVolume(volume) {
            if (musicElement) {
                musicElement.volume = volume;
                
                // 볼륨 변경 시 시각적 피드백
                const slider = document.getElementById('volumeSlider');
                slider.style.filter = `hue-rotate(${volume * 360}deg) brightness(${1 + volume})`;
                slider.style.transform = `scale(${1 + volume * 0.3}) rotate(${volume * 45}deg)`;
                
                setTimeout(() => {
                    slider.style.filter = '';
                    slider.style.transform = '';
                }, 200);
            }
        }

        function startGame() {
            if (!game) {
                game = new DinoDanceGame();
            }
            game.start();
        }

        function restartGame() {
            if (game) {
                game.start();
            }
        }

        // 추가적인 병맛 효과를 위한 전역 함수들
        function addGlobalCrazyEffects() {
            // 랜덤하게 화면 전체를 흔들기
            setInterval(() => {
                if (isPlaying && Math.random() < 0.1) {
                    document.body.style.transform = `translate(${Math.random() * 4 - 2}px, ${Math.random() * 4 - 2}px) rotate(${Math.random() * 2 - 1}deg)`;
                    setTimeout(() => {
                        document.body.style.transform = '';
                    }, 100);
                }
            }, 500);

            // 랜덤 글리치 효과
            setInterval(() => {
                if (isPlaying && Math.random() < 0.05) {
                    const elements = document.querySelectorAll('*');
                    const randomElement = elements[Math.floor(Math.random() * Math.min(elements.length, 50))];
                    if (randomElement) {
                        randomElement.style.filter = `hue-rotate(${Math.random() * 360}deg) contrast(${1 + Math.random() * 2})`;
                        setTimeout(() => {
                            randomElement.style.filter = '';
                        }, 150);
                    }
                }
            }, 300);

            // 배경 색상 폭발
            setInterval(() => {
                if (isPlaying && Math.random() < 0.08) {
                    const container = document.getElementById('gameContainer');
                    const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#fd79a8', '#fdcb6e', '#6c5ce7'];
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    container.style.backgroundColor = randomColor;
                    container.style.opacity = '0.8';
                    setTimeout(() => {
                        container.style.backgroundColor = '';
                        container.style.opacity = '';
                    }, 200);
                }
            }, 800);
        }

        // 키보드 이벤트로 추가 효과
        document.addEventListener('keydown', (e) => {
            if (isPlaying) {
                // 키보드를 누를 때마다 화면이 미친듯이 반응
                const container = document.getElementById('gameContainer');
                const effects = [
                    () => container.style.transform = 'scale(1.05) rotate(5deg)',
                    () => container.style.filter = 'hue-rotate(180deg) brightness(1.5)',
                    () => container.style.animation = 'shake 0.5s ease-in-out',
                    () => document.body.style.background = `hsl(${Math.random() * 360}, 70%, 50%)`
                ];
                
                const randomEffect = effects[Math.floor(Math.random() * effects.length)];
                randomEffect();
                
                setTimeout(() => {
                    container.style.transform = '';
                    container.style.filter = '';
                    container.style.animation = '';
                    document.body.style.background = '';
                }, 300);
            }
        });

        // 게임 초기화
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('musicActivationScreen').style.display = 'flex';
            document.getElementById('startScreen').style.display = 'none';
            game = new DinoDanceGame();
            
            // 전역 병맛 효과 시작
            addGlobalCrazyEffects();
            
            // 마우스 움직임에 따른 추가 효과
            let mouseTrailCount = 0;
            document.addEventListener('mousemove', (e) => {
                if (isPlaying && mouseTrailCount % 3 === 0) {
                    const trail = document.createElement('div');
                    trail.style.position = 'fixed';
                    trail.style.left = e.clientX + 'px';
                    trail.style.top = e.clientY + 'px';
                    trail.style.width = '8px';
                    trail.style.height = '8px';
                    trail.style.background = `hsl(${Math.random() * 360}, 100%, 60%)`;
                    trail.style.borderRadius = '50%';
                    trail.style.pointerEvents = 'none';
                    trail.style.zIndex = '9999';
                    trail.style.animation = 'mouseTrail 0.8s ease-out forwards';
                    trail.style.boxShadow = '0 0 10px currentColor';
                    
                    // 마우스 트레일 애니메이션
                    if (!document.getElementById('mouseTrailStyle')) {
                        const style = document.createElement('style');
                        style.id = 'mouseTrailStyle';
                        style.textContent = `
                            @keyframes mouseTrail {
                                0% {
                                    transform: scale(1) rotate(0deg);
                                    opacity: 0.8;
                                }
                                100% {
                                    transform: scale(3) rotate(360deg);
                                    opacity: 0;
                                }
                            }
                        `;
                        document.head.appendChild(style);
                    }
                    
                    document.body.appendChild(trail);
                    setTimeout(() => {
                        if (trail.parentNode) {
                            trail.parentNode.removeChild(trail);
                        }
                    }, 800);
                }
                mouseTrailCount++;
            });
            
            // 화면 클릭 시 폭죽 효과
            document.addEventListener('click', (e) => {
                if (isPlaying) {
                    createClickFireworks(e.clientX, e.clientY);
                }
            });
        });

        function createClickFireworks(x, y) {
            for (let i = 0; i < 8; i++) {
                const firework = document.createElement('div');
                firework.style.position = 'fixed';
                firework.style.left = x + 'px';
                firework.style.top = y + 'px';
                firework.style.width = '6px';
                firework.style.height = '6px';
                firework.style.background = `hsl(${i * 45}, 100%, 60%)`;
                firework.style.borderRadius = '50%';
                firework.style.pointerEvents = 'none';
                firework.style.zIndex = '9999';
                firework.style.boxShadow = '0 0 15px currentColor, 0 0 25px currentColor';
                
                const angle = (i / 8) * Math.PI * 2;
                const distance = 60 + Math.random() * 40;
                const endX = x + Math.cos(angle) * distance;
                const endY = y + Math.sin(angle) * distance;
                
                firework.style.animation = `clickFirework 0.8s ease-out forwards`;
                
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes clickFirework {
                        0% {
                            transform: translate(0, 0) scale(0.5) rotate(0deg);
                            opacity: 1;
                        }
                        100% {
                            transform: translate(${endX - x}px, ${endY - y}px) scale(0) rotate(360deg);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
                document.body.appendChild(firework);
                
                setTimeout(() => {
                    if (firework.parentNode) {
                        firework.parentNode.removeChild(firework);
                    }
                    if (style.parentNode) {
                        style.parentNode.removeChild(style);
                    }
                }, 800);
            }
        }

        // 페이지를 떠날 때 음악 정리
        window.addEventListener('beforeunload', () => {
            if (rythm) {
                rythm.stop();
            }
        });

        // 윈도우 크기 변경 시 추가 효과
        window.addEventListener('resize', () => {
            if (isPlaying) {
                const container = document.getElementById('gameContainer');
                container.style.animation = 'resizeWobble 0.6s ease-in-out';
                
                if (!document.getElementById('resizeWobbleStyle')) {
                    const style = document.createElement('style');
                    style.id = 'resizeWobbleStyle';
                    style.textContent = `
                        @keyframes resizeWobble {
                            0%, 100% { transform: scale(1) rotate(0deg); }
                            25% { transform: scale(1.02) rotate(2deg); }
                            50% { transform: scale(0.98) rotate(-1deg); }
                            75% { transform: scale(1.01) rotate(1deg); }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                setTimeout(() => {
                    container.style.animation = '';
                }, 600);
            }
        });

        // 스크롤 이벤트 (모바일 대응)
        document.addEventListener('scroll', () => {
            if (isPlaying) {
                document.body.style.filter = `hue-rotate(${window.scrollY}deg) brightness(${1 + window.scrollY * 0.001})`;
            }
        });

        // 터치 제스처 대응
        let touchStartTime = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartTime = Date.now();
            if (isPlaying) {
                const container = document.getElementById('gameContainer');
                container.style.transform = 'scale(1.02)';
                container.style.filter = 'brightness(1.2) hue-rotate(45deg)';
            }
        });

        document.addEventListener('touchend', (e) => {
            const touchDuration = Date.now() - touchStartTime;
            if (isPlaying) {
                const container = document.getElementById('gameContainer');
                container.style.transform = '';
                container.style.filter = '';
                
                // 긴 터치 시 특별 효과
                if (touchDuration > 500) {
                    createMegaExplosion();
                }
            }
        });

        function createMegaExplosion() {
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            
            for (let i = 0; i < 30; i++) {
                const explosion = document.createElement('div');
                explosion.style.position = 'fixed';
                explosion.style.left = centerX + 'px';
                explosion.style.top = centerY + 'px';
                explosion.style.width = '15px';
                explosion.style.height = '15px';
                explosion.style.background = `hsl(${i * 12}, 100%, 60%)`;
                explosion.style.borderRadius = Math.random() < 0.5 ? '50%' : '0%';
                explosion.style.pointerEvents = 'none';
                explosion.style.zIndex = '9999';
                explosion.style.boxShadow = '0 0 20px currentColor, 0 0 40px currentColor, 0 0 60px rgba(255,255,255,0.5)';
                
                const angle = (i / 30) * Math.PI * 2;
                const distance = 150 + Math.random() * 200;
                const endX = centerX + Math.cos(angle) * distance;
                const endY = centerY + Math.sin(angle) * distance;
                
                explosion.style.animation = `megaExplosion 2s ease-out forwards`;
                
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes megaExplosion {
                        0% {
                            transform: translate(0, 0) scale(0.2) rotate(0deg);
                            opacity: 1;
                            filter: brightness(3) hue-rotate(0deg);
                        }
                        50% {
                            transform: translate(${(endX - centerX) * 0.7}px, ${(endY - centerY) * 0.7}px) scale(2) rotate(360deg);
                            opacity: 0.8;
                            filter: brightness(5) hue-rotate(180deg);
                        }
                        100% {
                            transform: translate(${endX - centerX}px, ${endY - centerY}px) scale(0) rotate(720deg);
                            opacity: 0;
                            filter: brightness(8) hue-rotate(360deg) blur(10px);
                        }
                    }
                `;
                document.head.appendChild(style);
                document.body.appendChild(explosion);
                
                setTimeout(() => {
                    if (explosion.parentNode) {
                        explosion.parentNode.removeChild(explosion);
                    }
                    if (style.parentNode) {
                        style.parentNode.removeChild(style);
                    }
                }, 2000);
            }
            
            // 화면 전체 플래시 효과
            const flash = document.createElement('div');
            flash.style.position = 'fixed';
            flash.style.top = '0';
            flash.style.left = '0';
            flash.style.width = '100vw';
            flash.style.height = '100vh';
            flash.style.background = 'rgba(255,255,255,0.8)';
            flash.style.pointerEvents = 'none';
            flash.style.zIndex = '10000';
            flash.style.animation = 'megaFlash 0.5s ease-out forwards';
            
            const flashStyle = document.createElement('style');
            flashStyle.textContent = `
                @keyframes megaFlash {
                    0% { opacity: 1; }
                    100% { opacity: 0; }
                }
            `;
            document.head.appendChild(flashStyle);
            document.body.appendChild(flash);
            
            setTimeout(() => {
                if (flash.parentNode) {
                    flash.parentNode.removeChild(flash);
                }
                if (flashStyle.parentNode) {
                    flashStyle.parentNode.removeChild(flashStyle);
                }
            }, 500);
        }

        // 디바이스 모션 이벤트 (모바일)
        if (window.DeviceMotionEvent) {
            window.addEventListener('devicemotion', (e) => {
                if (isPlaying && e.accelerationIncludingGravity) {
                    const acceleration = Math.abs(e.accelerationIncludingGravity.x) + 
                                       Math.abs(e.accelerationIncludingGravity.y) + 
                                       Math.abs(e.accelerationIncludingGravity.z);
                    
                    if (acceleration > 20) {
                        // 폰을 흔들 때 화면이 미친듯이 반응
                        const container = document.getElementById('gameContainer');
                        container.style.animation = 'shakeResponse 0.3s ease-in-out';
                        container.style.filter = `hue-rotate(${acceleration * 10}deg) brightness(${1 + acceleration * 0.02})`;
                        
                        if (!document.getElementById('shakeResponseStyle')) {
                            const style = document.createElement('style');
                            style.id = 'shakeResponseStyle';
                            style.textContent = `
                                @keyframes shakeResponse {
                                    0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1); }
                                    25% { transform: translate(-5px, -5px) rotate(-5deg) scale(1.02); }
                                    50% { transform: translate(5px, -5px) rotate(5deg) scale(0.98); }
                                    75% { transform: translate(-5px, 5px) rotate(-3deg) scale(1.01); }
                                }
                            `;
                            document.head.appendChild(style);
                        }
                        
                        setTimeout(() => {
                            container.style.animation = '';
                            container.style.filter = '';
                        }, 300);
                    }
                }
            });
        }
    </script>
</body>
</html>
